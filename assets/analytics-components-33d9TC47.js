import{r as f,j as e,C as Y,E as k,U as M,M as D,a as O,b as P,T as p,c as K}from"./react-vendor-Co8v5os9.js";import{S as A,a as S,b,c as C,d as l,u as V,e as U,f as G,s as T,T as i,g as z,B as v,C as j,h as I,i as N,j as F,k as W,l as $}from"./index-BRJKGoUE.js";import{R as B,C as q,X,Y as y,T as H,B as _,L as Q}from"./charts-CWlq-tT4.js";const J=[{date:"2025-01-15",visitatori:0,tempoMedio:0,conversioni:0},{date:"2025-01-16",visitatori:0,tempoMedio:0,conversioni:0},{date:"2025-01-17",visitatori:0,tempoMedio:0,conversioni:0},{date:"2025-01-18",visitatori:0,tempoMedio:0,conversioni:0},{date:"2025-01-19",visitatori:0,tempoMedio:0,conversioni:0},{date:"2025-01-20",visitatori:0,tempoMedio:0,conversioni:0},{date:"2025-01-21",visitatori:0,tempoMedio:0,conversioni:0}],Z=({active:n,payload:t,label:d})=>{if(n&&t&&t.length){const c=a=>new Date(a).toLocaleDateString("it-IT",{weekday:"short",month:"short",day:"numeric"}),m=a=>{const x=Math.floor(a/60),h=a%60;return`${x}m ${h}s`};return e.jsxs("div",{className:"bg-background border border-border rounded-xl p-3 md:p-4 shadow-2xl backdrop-blur-sm max-w-xs",children:[e.jsx("div",{className:"border-b border-border pb-2 mb-2 md:mb-3",children:e.jsx("p",{className:"font-semibold text-foreground text-xs md:text-sm",children:c(d)})}),e.jsx("div",{className:"space-y-1.5 md:space-y-2",children:t.map((a,x)=>e.jsxs("div",{className:"flex items-center justify-between gap-2 md:gap-4",children:[e.jsxs("div",{className:"flex items-center gap-1.5 md:gap-2",children:[e.jsx("div",{className:"w-2.5 h-2.5 md:w-3 md:h-3 rounded-full",style:{backgroundColor:a.color}}),e.jsx("span",{className:"text-xs text-foreground-secondary font-medium",children:a.name==="visitatori"?"Visitatori":a.name==="tempoMedio"?"Tempo Medio":"Conversioni"})]}),e.jsxs("span",{className:"text-xs md:text-sm font-bold text-foreground",children:[a.name==="tempoMedio"?m(a.value):a.value,a.name==="visitatori"&&" utenti",a.name==="conversioni"&&" leads"]})]},x))}),e.jsx("div",{className:"border-t border-border pt-1.5 md:pt-2 mt-2 md:mt-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-foreground-muted",children:"Tasso Conversione:"}),e.jsx("span",{className:"text-xs font-semibold text-success",children:t.find(a=>a.name==="conversioni")&&t.find(a=>a.name==="visitatori")?Math.round(t.find(a=>a.name==="conversioni").value/t.find(a=>a.name==="visitatori").value*100)+"%":"N/A"})]})})]})}return null},ee=({data:n})=>{const[t,d]=f.useState("7days"),c=n&&n.length>0?n:J;return e.jsxs("div",{className:"chart-container p-3 md:p-8",children:[e.jsxs("div",{className:"block md:hidden mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold gradient-text mb-2",children:"Analytics"}),e.jsx("p",{className:"text-foreground-secondary text-xs mb-3",children:"Performance trends"}),e.jsx("div",{className:"flex flex-col gap-3 mb-4",children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(A,{value:t,onValueChange:d,children:[e.jsx(S,{className:"w-full h-8 text-xs",children:e.jsx(b,{})}),e.jsxs(C,{children:[e.jsx(l,{value:"7days",children:"Ultima Settimana"}),e.jsx(l,{value:"30days",children:"Ultimo Mese"}),e.jsx(l,{value:"90days",children:"Ultimi 3 Mesi"}),e.jsx(l,{value:"180days",children:"Ultimi 6 Mesi"})]})]})})}),e.jsxs("div",{className:"flex items-center justify-between text-xs mb-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-metric-blue"}),e.jsx("span",{className:"text-foreground-muted",children:"Visitatori"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-metric-emerald"}),e.jsx("span",{className:"text-foreground-muted",children:"Tempo"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-metric-violet"}),e.jsx("span",{className:"text-foreground-muted",children:"Conversioni"})]})]})]}),e.jsxs("div",{className:"hidden md:block mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-semibold gradient-text mb-2",children:"Performance Analytics"}),e.jsx("p",{className:"text-foreground-secondary",children:"Trend delle performance aggiornate - Gennaio 2025"})]}),e.jsxs("div",{className:"flex items-center gap-8 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-gradient-to-r from-metric-blue to-metric-cyan shadow-lg"}),e.jsx("span",{className:"text-foreground-secondary font-medium",children:"Visitatori"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-gradient-to-r from-metric-emerald to-metric-amber shadow-lg"}),e.jsx("span",{className:"text-foreground-secondary font-medium",children:"Tempo Sessione"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-gradient-to-r from-metric-violet to-metric-rose shadow-lg"}),e.jsx("span",{className:"text-foreground-secondary font-medium",children:"Conversioni"})]})]})]}),e.jsx("div",{className:"flex items-center gap-4 mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{size:16,className:"text-foreground-muted"}),e.jsxs(A,{value:t,onValueChange:d,children:[e.jsx(S,{className:"w-48",children:e.jsx(b,{})}),e.jsxs(C,{children:[e.jsx(l,{value:"7days",children:"Ultima Settimana"}),e.jsx(l,{value:"30days",children:"Ultimo Mese"}),e.jsx(l,{value:"90days",children:"Ultimi 3 Mesi"}),e.jsx(l,{value:"180days",children:"Ultimi 6 Mesi"})]})]})]})})]}),e.jsxs("div",{className:"h-48 md:h-96 relative overflow-hidden rounded-lg border border-glass-border bg-glass-background/30",children:[e.jsx("div",{className:"absolute inset-0 opacity-[0.02]",children:e.jsx("div",{className:"w-full h-full",style:{backgroundImage:`
              linear-gradient(to right, hsl(var(--foreground)) 1px, transparent 1px),
              linear-gradient(to bottom, hsl(var(--foreground)) 1px, transparent 1px)
            `,backgroundSize:"40px 40px"}})}),e.jsx(B,{width:"100%",height:"100%",children:e.jsxs(q,{data:c,margin:{top:20,right:10,left:10,bottom:5},children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"visitatoriGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"hsl(var(--metric-blue))",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"hsl(var(--metric-cyan))",stopOpacity:.2})]}),e.jsxs("linearGradient",{id:"conversioniGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"hsl(var(--metric-violet))",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"hsl(var(--metric-rose))",stopOpacity:.2})]})]}),e.jsx(X,{dataKey:"date",axisLine:!1,tickLine:!1,tick:{fill:"hsl(var(--foreground-secondary))",fontSize:10,fontWeight:500},tickFormatter:m=>m.slice(8)+"/"+m.slice(5,7),interval:"preserveStartEnd"}),e.jsx(y,{yAxisId:"left",axisLine:!1,tickLine:!1,tick:{fill:"hsl(var(--foreground-secondary))",fontSize:10,fontWeight:500},width:30}),e.jsx(y,{yAxisId:"right",orientation:"right",axisLine:!1,tickLine:!1,tick:{fill:"hsl(var(--foreground-secondary))",fontSize:10,fontWeight:500},width:30}),e.jsx(H,{content:e.jsx(Z,{})}),e.jsx(_,{yAxisId:"left",dataKey:"visitatori",fill:"url(#visitatoriGradient)",radius:[6,6,0,0],name:"visitatori"}),e.jsx(_,{yAxisId:"left",dataKey:"conversioni",fill:"url(#conversioniGradient)",radius:[6,6,0,0],name:"conversioni"}),e.jsx(Q,{yAxisId:"right",type:"monotone",dataKey:"tempoMedio",stroke:"hsl(var(--metric-emerald))",strokeWidth:3,dot:{fill:"hsl(var(--metric-emerald))",strokeWidth:2,r:4,stroke:"hsl(var(--background))"},activeDot:{r:6,fill:"hsl(var(--metric-emerald))",stroke:"hsl(var(--background))",strokeWidth:2,filter:"drop-shadow(0 0 10px hsl(var(--metric-emerald) / 0.6))"},name:"tempoMedio"})]})})]})]})},re=Object.freeze(Object.defineProperty({__proto__:null,default:ee},Symbol.toStringTag,{value:"Module"})),se=()=>{V();const{user:n}=U(),{analytics:t,isLoading:d,error:c,refreshData:m}=G((n==null?void 0:n.id)||""),[a,x]=f.useState("7d"),h=f.useRef(null),u=f.useRef(null),o={totalViews:(t==null?void 0:t.reduce((s,r)=>s+(r.views||0),0))||0,uniqueVisitors:(t==null?void 0:t.reduce((s,r)=>s+(r.unique_visitors||0),0))||0,totalClicks:(t==null?void 0:t.reduce((s,r)=>s+(r.clicks||0),0))||0,conversionRate:(t==null?void 0:t.length)>0?t.reduce((s,r)=>s+(r.conversion_rate||0),0)/t.length:0,avgSessionDuration:(t==null?void 0:t.length)>0?t.reduce((s,r)=>s+(r.avg_session_duration||0),0)/t.length:0,bounceRate:(t==null?void 0:t.length)>0?t.reduce((s,r)=>s+(r.bounce_rate||0),0)/t.length:0,viewsChange:0,visitorsChange:0,clicksChange:0,conversionChange:0};f.useEffect(()=>{if(!(n!=null&&n.id))return;console.log("[AnalyticsKPI] Setting up real-time subscriptions");const s=T.channel(`analytics-kpi-${n.id}`).on("postgres_changes",{event:"*",schema:"public",table:"analytics"},r=>{console.log("[AnalyticsKPI] Analytics change detected:",r),L()}).subscribe(r=>{console.log("[AnalyticsKPI] Subscription status:",r)});return h.current=s,()=>{console.log("[AnalyticsKPI] Cleaning up real-time subscriptions"),h.current&&T.removeChannel(h.current),u.current&&clearTimeout(u.current)}},[n==null?void 0:n.id]);const L=()=>{u.current&&clearTimeout(u.current),u.current=setTimeout(()=>{console.log("[AnalyticsKPI] Triggering debounced refresh"),m()},1e3)},g=s=>s>=1e6?(s/1e6).toFixed(1)+"M":s>=1e3?(s/1e3).toFixed(1)+"K":s.toString(),w=s=>s>=0?e.jsx(K,{className:"h-4 w-4"}):e.jsx(p,{className:"h-4 w-4"}),E=s=>s>=0?"text-green-600":"text-red-600",R=[{title:i.ANALYTICS.TOTAL_VIEWS,value:g(o.totalViews),change:o.viewsChange,icon:k,description:i.ANALYTICS.PAGE_VIEWS_DESCRIPTION},{title:i.ANALYTICS.UNIQUE_VISITORS,value:g(o.uniqueVisitors),change:o.visitorsChange,icon:M,description:i.ANALYTICS.DISTINCT_USERS_DESCRIPTION},{title:i.ANALYTICS.TOTAL_CLICKS,value:g(o.totalClicks),change:o.clicksChange,icon:D,description:i.ANALYTICS.INTERACTIVE_CLICKS_DESCRIPTION},{title:i.ANALYTICS.CONVERSION_RATE,value:isNaN(o.conversionRate)?"0.0%":`${o.conversionRate.toFixed(1)}%`,change:o.conversionChange,icon:O,description:i.ANALYTICS.CLICKS_PER_VIEW_DESCRIPTION},{title:i.ANALYTICS.AVG_SESSION_DURATION,value:z(o.avgSessionDuration),change:0,icon:P,description:i.ANALYTICS.AVG_TIME_SESSION_DESCRIPTION},{title:i.ANALYTICS.BOUNCE_RATE,value:isNaN(o.bounceRate)?"0.0%":`${o.bounceRate.toFixed(1)}%`,change:0,icon:p,description:i.ANALYTICS.SINGLE_PAGE_SESSIONS_DESCRIPTION}];return d?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:i.ANALYTICS.PERFORMANCE_ANALYTICS}),e.jsx("p",{className:"text-foreground-secondary",children:i.ANALYTICS.KEY_METRICS})]}),e.jsx("div",{className:"flex gap-2",children:["7d","30d","90d","1y"].map(s=>e.jsx(v,{variant:"outline",size:"sm",disabled:!0,children:s==="7d"?i.ANALYTICS.LAST_7_DAYS:s==="30d"?i.ANALYTICS.LAST_30_DAYS:s==="90d"?i.ANALYTICS.LAST_90_DAYS:i.ANALYTICS.LAST_YEAR},s))})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Array.from({length:6}).map((s,r)=>e.jsxs(j,{className:"animate-pulse",children:[e.jsx(I,{className:"pb-3",children:e.jsx("div",{className:"h-4 bg-muted rounded w-3/4"})}),e.jsxs(N,{children:[e.jsx("div",{className:"h-8 bg-muted rounded w-1/2 mb-2"}),e.jsx("div",{className:"h-3 bg-muted rounded w-full"})]})]},r))})]}):c?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:i.ANALYTICS.PERFORMANCE_ANALYTICS}),e.jsx("p",{className:"text-foreground-secondary",children:i.ANALYTICS.KEY_METRICS})]})}),e.jsx(j,{children:e.jsx(N,{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-destructive mb-2",children:c}),e.jsx(v,{onClick:()=>window.location.reload(),variant:"outline",children:"Reload Page"})]})})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:i.ANALYTICS.PERFORMANCE_ANALYTICS}),e.jsx("p",{className:"text-foreground-secondary",children:i.ANALYTICS.KEY_METRICS})]}),e.jsx("div",{className:"flex gap-2",children:["7d","30d","90d","1y"].map(s=>e.jsx(v,{variant:a===s?"default":"outline",size:"sm",onClick:()=>x(s),children:s==="7d"?i.ANALYTICS.LAST_7_DAYS:s==="30d"?i.ANALYTICS.LAST_30_DAYS:s==="90d"?i.ANALYTICS.LAST_90_DAYS:i.ANALYTICS.LAST_YEAR},s))})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:R.map((s,r)=>e.jsxs(j,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(I,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:e.jsx(s.icon,{className:"h-5 w-5 text-primary"})}),e.jsx(F,{className:"text-lg",children:s.title})]}),e.jsxs(W,{variant:s.change>=0?"default":"secondary",className:`${E(s.change)} flex items-center gap-1`,children:[w(s.change),Math.abs(s.change).toFixed(1),"%"]})]})}),e.jsx(N,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-3xl font-bold text-foreground",children:s.value}),e.jsx($,{className:"text-sm",children:s.description})]})})]},r))})]})},ne=Object.freeze(Object.defineProperty({__proto__:null,default:se},Symbol.toStringTag,{value:"Module"}));export{ne as A,re as S};
